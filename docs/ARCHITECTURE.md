# SkyClust 아키텍처

이 문서는 멀티 클라우드 관리 플랫폼인 SkyClust의 고수준 아키텍처를 설명합니다.

## 개요

SkyClust는 명확한 관심사 분리를 통해 유지보수성, 테스트 가능성, 확장성을 보장하는 Clean Architecture 원칙을 따릅니다.

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        프론트엔드 계층                       │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   React     │ │  Next.js   │ │  Tailwind   │           │
│  │ 컴포넌트    │ │   App      │ │     CSS     │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP/WebSocket
                                │
┌─────────────────────────────────────────────────────────────┐
│                      API 게이트웨이 계층                     │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   Gin       │ │ 미들웨어    │ │   라우트    │           │
│  │ 프레임워크  │ │   스택     │ │  관리자     │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                                │
                                │
┌─────────────────────────────────────────────────────────────┐
│                    애플리케이션 계층                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   핸들러    │ │   서비스    │ │   유스케이스│           │
│  │   (HTTP)    │ │ (비즈니스)  │ │ (오케스트.) │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                                │
                                │
┌─────────────────────────────────────────────────────────────┐
│                      도메인 계층                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │  엔티티     │ │  서비스    │ │   에러      │           │
│  │  (모델)     │ │(인터페이스) │ │ (도메인)    │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                                │
                                │
┌─────────────────────────────────────────────────────────────┐
│                   인프라 계층                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ PostgreSQL  │ │    Redis    │ │    NATS     │           │
│  │ (데이터베이스)│ │  (캐시)    │ │ (메시징)   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
```

## 계층별 상세

### 1. 프론트엔드 계층 (React/Next.js)

**책임:**
- 사용자 인터페이스 및 사용자 경험
- 상태 관리
- API 통신
- WebSocket/SSE를 통한 실시간 업데이트

**주요 컴포넌트:**
- **페이지**: 라우트 기반 페이지 컴포넌트
- **컴포넌트**: 재사용 가능한 UI 컴포넌트
- **훅**: 상태 관리를 위한 커스텀 React 훅
- **서비스**: API 통신 계층
- **스토어**: 전역 상태 관리

**기술:**
- App Router가 적용된 Next.js 14
- 서버 상태를 위한 React Query
- 스타일링을 위한 Tailwind CSS
- 타입 안전성을 위한 TypeScript

### 2. API 게이트웨이 계층

**책임:**
- HTTP 요청/응답 처리
- 인증 및 인가
- 요청 검증
- 응답 포맷팅
- 속도 제한

**주요 컴포넌트:**
- **핸들러**: HTTP 요청 핸들러
- **미들웨어**: 인증, 로깅, CORS
- **라우트**: URL 라우팅 설정
- **검증**: 입력 검증

**기술:**
- Gin 프레임워크
- 커스텀 미들웨어 스택
- JWT 인증
- 구조화된 로깅

### 3. 애플리케이션 계층

**책임:**
- 비즈니스 로직 오케스트레이션
- 유스케이스 구현
- 서비스 조정
- 트랜잭션 관리

**주요 컴포넌트:**
- **핸들러**: HTTP 요청 처리
- **서비스**: 비즈니스 로직 서비스
- **유스케이스**: 애플리케이션 워크플로우
- **DTO**: 데이터 전송 객체

**패턴:**
- Clean Architecture
- 의존성 주입
- 서비스 계층 패턴
- 저장소 패턴

### 4. 도메인 계층

**책임:**
- 핵심 비즈니스 로직
- 도메인 엔티티
- 비즈니스 규칙
- 도메인 서비스

**주요 컴포넌트:**
- **엔티티**: 핵심 비즈니스 객체
- **값 객체**: 불변 객체
- **서비스**: 도메인 서비스
- **저장소**: 데이터 접근 인터페이스
- **에러**: 도메인별 에러

**원칙:**
- 도메인 주도 설계 (DDD)
- 단일 책임 원칙
- 의존성 역전

### 5. 인프라 계층

**책임:**
- 데이터 지속성
- 외부 서비스 통합
- 캐싱
- 메시지 큐잉

**주요 컴포넌트:**
- **데이터베이스**: GORM이 적용된 PostgreSQL
- **캐시**: 캐싱을 위한 Redis
- **메시징**: 이벤트를 위한 NATS
- **플러그인**: 클라우드 프로바이더 플러그인

## 데이터 플로우

### 요청 플로우

1. **프론트엔드**가 HTTP 요청 전송
2. **API 게이트웨이**가 요청을 검증하고 라우팅
3. **애플리케이션 계층**이 비즈니스 로직 처리
4. **도메인 계층**이 비즈니스 규칙 적용
5. **인프라 계층**이 데이터 지속화
6. **응답**이 계층을 거쳐 역순으로 전달

### 이벤트 플로우

1. **도메인 이벤트**가 트리거됨
2. **애플리케이션 계층**이 이벤트 처리
3. **인프라 계층**이 NATS에 이벤트 게시
4. **프론트엔드**가 실시간 업데이트 수신
5. **UI**가 자동으로 업데이트

## 주요 설계 패턴

### 1. Clean Architecture

- **독립성**: 프레임워크 독립적인 비즈니스 로직
- **테스트 가능성**: 쉬운 단위 테스트
- **유지보수성**: 명확한 관심사 분리
- **유연성**: 외부 의존성 변경 용이

### 2. 의존성 주입

- **느슨한 결합**: 런타임에 의존성 주입
- **테스트 가능성**: 의존성 모킹 용이
- **유연성**: 구현체 교체 용이

### 3. 저장소 패턴

- **데이터 접근**: 추상화된 데이터 접근 계층
- **테스트 가능성**: 데이터 접근 모킹 용이
- **유연성**: 데이터 소스 변경 용이

### 4. 서비스 계층 패턴

- **비즈니스 로직**: 중앙화된 비즈니스 로직
- **재사용성**: 공유 비즈니스 로직
- **유지보수성**: 명확한 비즈니스 로직 구성

## 보안 아키텍처

### 인증 플로우

1. **사용자**가 자격증명 제공
2. **인증 서비스**가 자격증명 검증
3. **JWT 토큰**이 생성됨
4. **토큰**이 보안 쿠키에 저장됨
5. **미들웨어**가 각 요청에서 토큰 검증

### 인가 플로우

1. **요청**에 JWT 토큰 포함
2. **미들웨어**가 사용자 정보 추출
3. **RBAC 서비스**가 권한 확인
4. **요청**이 허용되거나 거부됨

### 데이터 보호

- **암호화**: 민감한 데이터를 위한 AES 암호화
- **해싱**: 비밀번호를 위한 bcrypt
- **검증**: 입력 검증 및 살균
- **감사**: 완전한 감사 추적

## 확장성 고려사항

### 수평적 확장

- **무상태**: 애플리케이션이 무상태
- **로드 밸런싱**: 로드 밸런서 뒤의 여러 인스턴스
- **데이터베이스**: 읽기 작업을 위한 읽기 복제본
- **캐시**: 캐싱을 위한 Redis 클러스터

### 수직적 확장

- **메모리**: 최적화된 메모리 사용
- **CPU**: 효율적인 알고리즘
- **데이터베이스**: 쿼리 최적화
- **캐싱**: 적극적인 캐싱 전략

## 모니터링 및 관찰성

### 메트릭

- **애플리케이션 메트릭**: 요청률, 지연시간, 에러
- **비즈니스 메트릭**: 사용자 활동, 리소스 사용량
- **인프라 메트릭**: CPU, 메모리, 디스크 사용량

### 로깅

- **구조화된 로깅**: JSON 형식 로그
- **로그 레벨**: Debug, Info, Warn, Error
- **상관관계 ID**: 요청 추적
- **감사 로그**: 보안 및 컴플라이언스

### 추적

- **분산 추적**: 서비스 간 요청 플로우
- **성능**: 병목 지점 식별
- **디버깅**: 문제 해결

## 배포 아키텍처

### 개발 환경

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   프론트엔드│    │   백엔드    │    │  데이터베이스│
│   (Next.js) │◄──►│    (Go)     │◄──►│(PostgreSQL) │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                           ▼
                   ┌─────────────┐
                   │    Redis    │
                   │   (캐시)    │
                   └─────────────┘
```

### 프로덕션 환경

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   로드      │    │   백엔드    │    │  데이터베이스│
│  밸런서     │◄──►│  클러스터   │◄──►│  클러스터   │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                           ▼
                   ┌─────────────┐
                   │   Redis     │
                   │  클러스터   │
                   └─────────────┘
```

## 기술 스택

### 백엔드

- **언어**: Go 1.21+
- **프레임워크**: Gin
- **ORM**: GORM
- **데이터베이스**: PostgreSQL 15
- **캐시**: Redis 7
- **메시징**: NATS 2.10
- **인증**: JWT
- **로깅**: Zap

### 프론트엔드

- **프레임워크**: Next.js 14
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **상태**: React Query
- **HTTP**: Axios
- **실시간**: WebSocket/SSE

### 인프라

- **컨테이너화**: Docker
- **오케스트레이션**: Docker Compose
- **데이터베이스**: PostgreSQL
- **캐시**: Redis
- **메시징**: NATS
- **모니터링**: 내장 메트릭

## 향후 고려사항

### 마이크로서비스 마이그레이션

- **서비스 분해**: 마이크로서비스로 분해
- **API 게이트웨이**: 중앙화된 API 관리
- **서비스 메시**: 서비스 간 통신
- **이벤트 소싱**: 이벤트 기반 아키텍처

### 클라우드 네이티브

- **Kubernetes**: 컨테이너 오케스트레이션
- **Helm**: 패키지 관리
- **Istio**: 서비스 메시
- **Prometheus**: 모니터링
- **Grafana**: 시각화

### 고급 기능

- **멀티 테넌시**: 향상된 테넌트 격리
- **플러그인 시스템**: 동적 플러그인 로딩
- **워크플로 엔진**: 비즈니스 프로세스 자동화
- **AI/ML**: 지능형 리소스 관리